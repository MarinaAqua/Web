<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proxy List Checker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1E1E2F;
            color: white;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        .proxy-item {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 15px;
            border: 1px solid #444;
            margin: 8px 0;
            background: linear-gradient(135deg, #2c2c3e, #25252d);
            border-radius: 8px;
        }

        .proxy-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 10px;
        }

        .active {
            background-color: green;
        }

        .dead {
            background-color: red;
        }

        .proxy-details {
            margin-top: 5px;
            color: #ccc;
        }

        button {
            background: linear-gradient(135deg, #6e00ff, #9e4ed0);
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 5px;
            transition: background 0.3s;
        }

        button:hover {
            background: linear-gradient(135deg, #9e4ed0, #6e00ff);
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        .pagination button,
        .pagination span {
            background: transparent;
            color: white;
            border: 1px solid #444;
            border-radius: 5px;
            padding: 8px 12px;
            margin: 0 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .pagination button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .ellipsis {
            margin: 0 5px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Proxy List Checker</h1>
        <div id="proxy-list">
            <!-- Proxy items will be added here -->
        </div>
        <div class="pagination" id="pagination">
            <button onclick="prevPage()">Prev</button>
            <span id="page-numbers"></span>
            <button onclick="nextPage()">Next</button>
        </div>
    </div>
    <script>
        const proxyList = [];
        let currentPage = 1;
        const itemsPerPage = 10;

        async function fetchProxies() {
            const response = await fetch('https://raw.githubusercontent.com/clubgratis/Proxy/refs/heads/main/all.txt');
            const text = await response.text();
            const lines = text.split('\n');
            lines.forEach(line => {
                const [ip, port, country, isp] = line.split(',');  // Memisahkan IP, port, negara, dan ISP
                if (ip && port && country && isp) {
                    proxyList.push({ ip, port, country, isp });
                }
            });
            await renderProxies();
            renderPagination();
        }

        async function checkProxy(ip, port) {
            try {
                const response = await fetch(`https://api-checker.aquamarinelavinia.workers.dev/?ip=${ip}:${port}`);
                const result = await response.json();
                
                // Debugging output
                console.log(result); // Tampilkan hasil API di konsol
                
                // Memeriksa status aktif menggunakan message
                if (result.message && (result.message.includes('ACTIVE') || result.message.includes('ACTIVO'))) {
                    return true; // Proxy aktif 
                } else {
                    return false; // Proxy tidak aktif
                }
            } catch (error) {
                console.error(`Failed to check proxy ${ip}:${port} - ${error}`);
                return false; // Anggap proxy tidak aktif jika gagal
            }
        }

        async function renderProxies() {
            const proxyDiv = document.getElementById('proxy-list');
            proxyDiv.innerHTML = ''; // Kosongkan sebelumnya

            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedProxies = proxyList.slice(start, end);

            for (const proxy of paginatedProxies) {
                const isActive = await checkProxy(proxy.ip, proxy.port); // Cek status
                const item = document.createElement('div');
                item.className = 'proxy-item';
                item.innerHTML = `
                    <div class="proxy-header">
                        <span>${proxy.isp} <span class="status ${isActive ? 'active' : 'dead'}"></span></span>
                    </div>
                    <div class="proxy-details">
                        Country: ${proxy.country} <br />
                        IP: ${proxy.ip}:${proxy.port}
                    </div>
                    <button onclick="createConnection('${proxy.ip}', '${proxy.port}')">Create</button>
                `;
                proxyDiv.appendChild(item);
            }
        }

        function renderPagination() {
            const pageNumbersDiv = document.getElementById('page-numbers');
            const totalPages = Math.ceil(proxyList.length / itemsPerPage);
            pageNumbersDiv.innerHTML = ''; // Kosongkan sebelumnya

            // Previous Button
            if (currentPage > 1) {
                pageNumbersDiv.appendChild(createPageButton(currentPage - 1, 'Prev'));
            }

            let startIndex = Math.max(1, currentPage - 2);
            let endIndex = Math.min(totalPages, startIndex + 4);

            if (startIndex > 1) {
                pageNumbersDiv.appendChild(createPageButton(1, '1'));
                if (startIndex > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'ellipsis';
                    ellipsis.textContent = '...';
                    pageNumbersDiv.appendChild(ellipsis);
                }
            }

            for (let i = startIndex; i <= endIndex; i++) {
                pageNumbersDiv.appendChild(createPageButton(i, i));
            }

            if (endIndex < totalPages) {
                if (endIndex < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'ellipsis';
                    ellipsis.textContent = '...';
                    pageNumbersDiv.appendChild(ellipsis);
                }
                pageNumbersDiv.appendChild(createPageButton(totalPages, totalPages));
            }

            // Next Button
            if (currentPage < totalPages) {
                pageNumbersDiv.appendChild(createPageButton(currentPage + 1, 'Next'));
            }
        }

        function createPageButton(page, text) {
            const button = document.createElement('button');
            button.textContent = text;
            button.onclick = () => {
                currentPage = page;
                renderProxies();
                renderPagination();
            };
            return button;
        }

        function createConnection(ip, port) {
            alert(`Creating connection for IP: ${ip}, Port: ${port}`);
        }

        // Fetch proxies saat halaman dimuat
        fetchProxies();
    </script>
</body>
</html>
