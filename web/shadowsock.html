<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Buat Akun Shadowsocks</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

  <!-- Header -->
  <div class="bg-blue-600 text-white text-center py-4 text-xl font-semibold">
    ✅ SHADOWSOCKS Created
  </div>

  <!-- Form -->
  <div class="max-w-md mx-auto mt-6 p-4 bg-white rounded shadow space-y-4">
    <input id="ipPort" type="text" placeholder="Masukkan IP:Port (contoh: 104.26.14.14:443)" class="w-full border p-2 rounded" />
    <input id="domain" type="text" placeholder="Domain (contoh: bug.cloudflare.com)" class="w-full border p-2 rounded" />
    <input id="bug" type="text" placeholder="Bug Wildcard (contoh: cdn.cloudflare.net)" class="w-full border p-2 rounded" />
    <button onclick="generateSS()" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">
      🔧 Buat Akun
    </button>
  </div>

  <!-- Hasil -->
  <div id="result" class="max-w-md mx-auto mt-4 p-4 bg-white rounded shadow hidden space-y-3 text-sm">
    <div>🌐 Remark: <span id="remarks" class="font-semibold"></span></div>
    <div>📡 Domain: <span id="res-domain"></span></div>
    <div>🐞 SNI/Bug: <span id="res-bug"></span></div>
    <div>🔑 Password: <span id="uuid">aaaaaaa1-bbbb-4ccc-addd-eeeeeeeeeee1</span></div>
    <div>🛡️ Method: <span id="none"></span></div>
    <div>📁 Plugin: <span id="websocket"></span></div>
    <div>🔗 Link:
      <textarea readonly id="ss-link" class="w-full mt-1 p-2 bg-gray-100 rounded text-xs"></textarea>
    </div>
    <div class="text-center">
      <img id="qrcode" src="" alt="QR Code" class="mx-auto my-2 rounded shadow" />
      <button onclick="copyConfig()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
        📋 Salin Konfigurasi
      </button>
    </div>
  </div>

  <!-- Script -->
  <script>
    async function generateSS() {
      const ipPort = document.getElementById('ipPort').value.trim();
      const domain = document.getElementById('domain').value.trim();
      const bug = document.getElementById('bug').value.trim();
      const resultBox = document.getElementById('result');

      if (!ipPort || !domain || !bug || !ipPort.includes(':')) {
        alert('Isi semua field dengan benar.');
        return;
      }

      const [ip, port] = ipPort.split(':');
      const password = 'aaaaaaa1-bbbb-4ccc-addd-eeeeeeeeeee1';
      const path = `${ip}-${port}`;
      const method = 'none';
      const url = `https://api-checker.aquamarinelavinia.workers.dev/?ip=${ip}:${port}`;

      try {
        const res = await fetch(url);
        const data = await res.json();

        if (!data.message || !data.message.includes('ACTIVE')) {
          alert('Proxy tidak aktif!');
          return;
        }

        const remarks = `${data.country} ${data.flag} [${data.isp}]`;
        const plugin = `path=/Club-Gratis/${path}`;
        const userInfo = btoa(`${password}`);
        const link = `ss://${userinfo}@${bug}:443?plugin=${encodeURIComponent(plugin)}#${encodeURIComponent(remarks)}`;

        // Tampilkan hasil
        document.getElementById('remarks').textContent = remarks;
        document.getElementById('res-domain').textContent = domain;
        document.getElementById('res-domain2').textContent = domain;
        document.getElementById('res-bug').textContent = bug;
        document.getElementById('res-path').textContent = path;
        document.getElementById('ss-link').value = link;
        document.getElementById('qrcode').src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(link)}`;
        resultBox.classList.remove('hidden');

      } catch (err) {
        alert('Gagal mengambil data proxy.');
        console.error(err);
      }
    }

    function copyConfig() {
      const link = document.getElementById('ss-link');
      link.select();
      document.execCommand('copy');
      alert('Konfigurasi berhasil disalin!');
    }
  </script>
</body>
</html>
